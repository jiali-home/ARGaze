TRAIN:
    ENABLE: True
    DATASET: Egoexo4dgaze
    BATCH_SIZE: 16
    EVAL_PERIOD: 1
    CHECKPOINT_PERIOD: 1
    AUTO_RESUME: True
    CHECKPOINT_EPOCH_RESET: True
DATA:
    PATH_PREFIX: "/data/egtea_gp"
    NUM_FRAMES: 8
    SAMPLING_RATE: 8
    TRAIN_JITTER_SCALES: [256, 320]
    TRAIN_CROP_SIZE: 256
    TEST_CROP_SIZE: 256
    INPUT_CHANNEL_NUM: [3]
    TARGET_FPS: 8
    USE_OFFSET_SAMPLING: False

    # Heatmap generation sigma (in heatmap pixels). Used by gaze dataloader.
    HEATMAP_SIGMA: 3.0
    GAUSSIAN_KERNEL: 19
    WINDOW_STRIDE: 4
    FILL_NAN_CENTER: True
    INTERPOLATE_NAN: True
    SKIP_FRAME_EXISTS_CHECK: True
    
    # Cache controls
    SKIP_INDEX_CACHE_LOAD: False # whether to skip loading index cache: default is False, means load index cache
    SKIP_TAKE_CACHE_LOAD: False # whether to skip loading take cache: default is False, means load take cache
    SKIP_MISSING_FRAMES_DIR: True

    # Quick debug subsampling (fraction of CSV rows per split). Set back to 1.0 for full run.
    SUBSAMPLE_TRAIN_FRACTION: 1.0
    SUBSAMPLE_VAL_FRACTION: 1.0
    VISUALIZE: False
    VIS_DIR: "explore/gaze_previews"
    MODE: "offline"
    FRAMES_DIR: "/mnt/data1/data/gaze/egoexo4d/takes_frames"
    VIDEO_ROOT_DIR: "/mnt/data1/data/gaze/egoexo4d/takes"
    SPLIT_ASSIGNMENTS_CSV: "/mnt/data1/data/gaze/egoexo4d/split_assignments_data3.csv"
    GAZE_DATA_DIR: "/mnt/data1/data/gaze/egoexo4d/gaze_data"
    MPS_ENABLED: False
    # Persistent on-disk cache to avoid re-indexing each run
    # CACHE_DIR: "/mnt/data2/jiali/data/egoexo4d/.gaze_cache"

MVIT:
    ZERO_DECAY_POS_CLS: False
    SEP_POS_EMBED: True
    DEPTH: 16
    NUM_HEADS: 1
    EMBED_DIM: 96
    PATCH_KERNEL: (3, 7, 7)
    PATCH_STRIDE: (2, 4, 4)
    PATCH_PADDING: (1, 3, 3)
    MLP_RATIO: 4.0
    QKV_BIAS: True
    DROPPATH_RATE: 0.2
    NORM: "layernorm"
    MODE: "conv"
    CLS_EMBED_ON: False
    GLOBAL_EMBED_ON: True
    DIM_MUL: [[1, 2.0], [3, 2.0], [14, 2.0]]
    HEAD_MUL: [[1, 2.0], [3, 2.0], [14, 2.0]]
    POOL_KVQ_KERNEL: [3, 3, 3]
    POOL_KV_STRIDE_ADAPTIVE: [1, 8, 8]
    POOL_Q_STRIDE: [[1, 1, 2, 2], [3, 1, 2, 2], [14, 1, 2, 2]]
    DROPOUT_RATE: 0.0
BN:
    USE_PRECISE_STATS: False
    NUM_BATCHES_PRECISE: 200
SOLVER:
    ZERO_WD_1D_PARAM: True
    CLIP_GRAD_L2NORM: 1.0
    BASE_LR_SCALE_NUM_SHARDS: True
    BASE_LR: 0.0001
    COSINE_AFTER_WARMUP: True
    COSINE_END_LR: 1e-6
    WARMUP_START_LR: 1e-6
    WARMUP_EPOCHS: 5.0
    LR_POLICY: cosine
    MAX_EPOCH: 25
    MOMENTUM: 0.9
    WEIGHT_DECAY: 0.05
    OPTIMIZING_METHOD: adamw
MODEL:
    NUM_CLASSES: 400
    ARCH: mvit
    MODEL_NAME: Egoexo4d_Gaze
    LOSS_FUNC: kldiv
    DROPOUT_RATE: 0.5
    CAUSAL: False
    DECODE_LAST: False
    HEATMAP_ACTIVATION: "none"

TEST:
    ENABLE: False
    DATASET: Egoexogazeclipdataset
    BATCH_SIZE: 12
    NUM_SPATIAL_CROPS: 1
    NUM_ENSEMBLE_VIEWS: 1
    ENABLE_SUBSET: False
    SUBSET_SIZE: 0
DATA_LOADER:
    NUM_WORKERS: 8
    PIN_MEMORY: True
TENSORBOARD:
    ENABLE: True

NUM_GPUS: 2
NUM_SHARDS: 1
RNG_SEED: 0
OUTPUT_DIR: /mnt/data2/jiali/tmp_output/EgoExo4D_GLC

PERF:
    LOG_PERIOD: 100
    METRICS_PERIOD: 100
    METRICS_PERIOD_FULL: 400
    METRICS_BATCH_FRACTION: 0.25
    VAL_MAX_STEPS: 100
    VAL_SUBSAMPLE: 2
    ALLOW_TF32: True

POSE:
    ENABLE: False
    BLOCK_IDXS: [0, 4, 8, 12]
    DROPOUT: 0.0

WANDB:
    PROJECT: GLC_Gaze
    LOG_IMAGES: True
    IMG_LOG_PERIOD: 200
    IMG_LOG_SAMPLES: 2
    ENTITY: zoeyyyyy521

# Optional: push checkpoints to Hugging Face Hub
HF:
    ENABLE: True
    REPO_ID: "JiaLi0108/EgoExo4D_GLC_Causal_DecodeLast_newSplit"
    BRANCH: main
    PRIVATE: True
    PATH_PREFIX: checkpoints
    INCLUDE_LATEST: True
