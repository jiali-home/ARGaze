# Configuration for DINOv3_ARHeatmapGazeTemplate on EgoExo4D gaze
# Uses template crops around previous gaze location for better tracking

TRAIN:
  ENABLE: True
  DATASET: Egoexo4dgaze
  BATCH_SIZE: 12
  EVAL_PERIOD: 1
  CHECKPOINT_PERIOD: 1
  AUTO_RESUME: True
  CHECKPOINT_EPOCH_RESET: True
  CHECKPOINT_KEEP_LAST_N: 3
  CHECKPOINT_BEST_METRIC: f1

DATA:
  PATH_PREFIX: '/mnt/data1/data/gaze/egoexo4d'
  FRAMES_DIR: '/mnt/data1/data/gaze/egoexo4d/takes_frames'
  VIDEO_ROOT_DIR: '/mnt/data1/data/gaze/egoexo4d'
  GAZE_DATA_DIR: '/mnt/data1/data/gaze/egoexo4d/gaze_data'
  SPLIT_ASSIGNMENTS_CSV: '/mnt/data1/data/gaze/egoexo4d/split_assignments_data3.csv'

  FRAME_EXT: 'jpg'
  NUM_FRAMES: 8
  SAMPLING_RATE: 8
  TRAIN_JITTER_SCALES: [256, 320]
  TRAIN_CROP_SIZE: 224
  TEST_CROP_SIZE: 224
  INPUT_CHANNEL_NUM: [3]
  TARGET_FPS: 8
  USE_OFFSET_SAMPLING: False
  GAUSSIAN_KERNEL: 19

  # EgoExo4D-specific data settings
  HEATMAP_SIGMA: 3.0
  WINDOW_STRIDE: 8
  FILL_NAN_CENTER: True
  INTERPOLATE_NAN: True
  SKIP_FRAME_EXISTS_CHECK: True

  # Cache controls
  SKIP_INDEX_CACHE_LOAD: False
  SKIP_TAKE_CACHE_LOAD: False
  SKIP_MISSING_FRAMES_DIR: True

  # Data subsampling
  SUBSAMPLE_TRAIN_FRACTION: 1.0
  SUBSAMPLE_VAL_FRACTION: 1.0
  VISUALIZE: False

MODEL:
  ARCH: dinov3
  MODEL_NAME: DINOv3_ARHeatmapGazeTemplate
  NUM_CLASSES: 1
  LOSS_FUNC: kldiv
  DROPOUT_RATE: 0.1
  CAUSAL: False
  DECODE_LAST: False

  DINOV3_MODEL_NAME: "facebook/dinov3-vits16-pretrain-lvd1689m"
  FREEZE_ENCODER: True
  UNFREEZE_LAST_K_LAYERS: 0

  USE_MULTISCALE_FEATURES: True
  MULTISCALE_LAYERS: [-3, -2, -1]

  HISTORY_LENGTH: 3
  HEATMAP_SIZE: 64
  NUM_DECODER_LAYERS: 3
  NUM_ATTENTION_HEADS: 8
  DIM_FEEDFORWARD: 1536

  # Template-specific parameters
  TEMPLATE_SCALES: [0.25]  # Crop size as fraction of image size (0.25 = 25% of frame)

SOLVER:
  BASE_LR: 0.0001
  LR_POLICY: cosine
  MAX_EPOCH: 15
  MOMENTUM: 0.9
  WEIGHT_DECAY: 0.05
  WARMUP_EPOCHS: 5.0
  WARMUP_START_LR: 0.00001
  COSINE_END_LR: 1e-6
  OPTIMIZING_METHOD: adamw
  CLIP_GRAD_L2NORM: 1.0
  ZERO_WD_1D_PARAM: True
  BASE_LR_SCALE_NUM_SHARDS: True

TEST:
  ENABLE: True
  DATASET: Egoexo4dgaze
  BATCH_SIZE: 12
  NUM_SPATIAL_CROPS: 1
  NUM_ENSEMBLE_VIEWS: 1

DATA_LOADER:
  NUM_WORKERS: 8
  PIN_MEMORY: True

TENSORBOARD:
  ENABLE: True

WANDB:
  ENABLE: True
  PROJECT: "AR x EgoExo4D"
  ENTITY: "zoeyyyyy521"
  RUN_NAME: "dinov3_ar_heatmap_gaze_template_egoexo4d"
  MODE: online
  LOG_SAMPLES_EVERY_TRAIN: 400
  LOG_SAMPLES_EVERY_VAL: 100
  NUM_SAMPLE_FRAMES: 3
  LOG_VAL_SAMPLES: True

NUM_GPUS: 2
NUM_SHARDS: 1
RNG_SEED: 0
OUTPUT_DIR: ./output/dinov3_egoexo4d_ar_heatmap_gaze_template
